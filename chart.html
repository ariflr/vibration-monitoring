<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictive Maintenance Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1a1a2e; color: #e0e0e0; margin: 0; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #e0e0e0; margin: 0; }
        .header p { color: #a9a9a9; }
        .main-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #16213e; border-radius: 8px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.2s ease-in-out; }
        .card:hover { transform: translateY(-5px); }
        .card-title { font-size: 1em; color: #a9a9a9; margin-bottom: 10px; text-transform: uppercase; }
        .card-value { font-size: 2.5em; font-weight: bold; }
        .chart-container { grid-column: 1 / -1; height: 350px; }
        .status-Good { color: #2ecc71; }
        .status-Acceptable { color: #f1c40f; }
        .status-Caution { color: #e67e22; }
        .status-Critical { color: #e74c3c; }
        .connecting { color: #3498db; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

    <div class="header">
        <h1>Predictive Maintenance Dashboard</h1>
        <p>Real-time Motor Vibration & Analysis System (<span id="connection-status" class="connecting">Connecting...</span>)</p>
    </div>

    <div class="main-container">
        <div class="card">
            <div class="card-title">RMS (MM/S)</div>
            <div class="card-value" id="rms-value">--</div>
        </div>
        <div class="card">
            <div class="card-title">ZONE</div>
            <div class="card-value" id="zone-value">--</div>
        </div>
        <div class="card">
            <div class="card-title">STATUS</div>
            <div class="card-value" id="status-value">--</div>
        </div>
        <div class="card">
            <div class="card-title">LAST UPDATE</div>
            <div class="card-value" id="last-update-value" style="font-size: 1.5em;">--</div>
        </div>

        <div class="card chart-container">
            <canvas id="rms-chart"></canvas>
        </div>
        
        <div class="card">
            <div class="card-title">PREDICTION (Hours to Next Zone)</div>
            <div class="card-value" id="prediction-hours">--</div>
        </div>
        <div class="card">
            <div class="card-title">MAINTENANCE RECOMMENDATION</div>
            <div class="card-value" id="prediction-recommendation" style="font-size: 1.2em;">--</div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI FIREBASE ---
        const firebaseConfig = {
            // Isi dengan konfigurasi Firebase Anda
            // Contoh:
            apiKey: "AIz...",
            authDomain: "predictive-maintenance-90034.firebaseapp.com",
            databaseURL: "https://predictive-maintenance-90034-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "predictive-maintenance-90034",
            storageBucket: "predictive-maintenance-90034.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Cek status koneksi Firebase
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
          const statusEl = document.getElementById('connection-status');
          if (snap.val() === true) {
            statusEl.textContent = "Connected";
            statusEl.className = 'status-Good';
          } else {
            statusEl.textContent = "Disconnected";
            statusEl.className = 'status-Critical';
          }
        });


        // --- Inisialisasi Chart.js ---
        const ctx = document.getElementById('rms-chart').getContext('2d');
        const rmsChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{
                label: 'RMS Vibration (mm/s)', data: [],
                borderColor: '#0f4c75', backgroundColor: 'rgba(15, 76, 117, 0.2)',
                borderWidth: 2, fill: true, tension: 0.4
            }]},
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { color: '#e0e0e0' } },
                    x: { ticks: { color: '#e0e0e0' } }
                },
                plugins: { legend: { labels: { color: '#e0e0e0' } } }
            }
        });

        // ======================================================================
        // PERBAIKAN UTAMA: Mendengarkan data dari alamat '/dashboard/'
        // ======================================================================

        // --- Listener untuk Data Live (Gauge & Status) ---
        const liveDataRef = database.ref('dashboard/live_data');
        liveDataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                const rmsEl = document.getElementById('rms-value');
                const zoneEl = document.getElementById('zone-value');
                const statusEl = document.getElementById('status-value');
                
                rmsEl.textContent = data.rms || '--';
                zoneEl.textContent = data.zone || '--';
                statusEl.textContent = data.status || '--';
                
                document.getElementById('last-update-value').textContent = data.last_update || '--';
                
                statusEl.className = 'card-value';
                rmsEl.className = 'card-value';
                if(data.status) {
                    statusEl.classList.add(`status-${data.status}`);
                    rmsEl.classList.add(`status-${data.status}`);
                }
            } else {
                document.getElementById('rms-value').textContent = 'Waiting...';
            }
        });

        // --- Listener untuk Chart Historis ---
        const historicalChartRef = database.ref('dashboard/historical_chart');
        historicalChartRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                const labels = [];
                const rmsData = [];
                const sortedKeys = Object.keys(data).sort();
                
                sortedKeys.forEach(key => {
                    labels.push(data[key].timestamp);
                    rmsData.push(data[key].rms);
                });
                
                rmsChart.data.labels = labels;
                rmsChart.data.datasets[0].data = rmsData;
                rmsChart.update();
            } else {
                console.log("Menunggu data historis...");
            }
        });
        
        // --- Listener untuk Data Prediksi ---
        const predictionDataRef = database.ref('dashboard/prediction_data');
        predictionDataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('prediction-hours').textContent = data.hours_to_next_zone || '--';
                document.getElementById('prediction-recommendation').textContent = data.recommendation || '--';
            } else {
                document.getElementById('prediction-hours').textContent = 'Awaiting Model...';
                document.getElementById('prediction-recommendation').textContent = 'Awaiting Model...';
            }
        });

    </script>
</body>
</html>
